name: WIP Labeler

on:
  pull_request:
    types: [opened, reopened, ready_for_review, converted_to_draft]

permissions:
  issues: write
  pull-requests: write
  contents: read

jobs:
  wip-labeler:
    runs-on: ubuntu-latest
    
    steps:
      - name: Add WIP label to draft PRs
        if: github.event.pull_request.draft == true
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            try {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                labels: ['work in progress']
              });
              console.log('Added "work in progress" label to draft PR');
            } catch (error) {
              console.log('Error adding label:', error.message);
              // Don't fail the workflow if label doesn't exist or other issues
            }

      - name: Remove WIP label from ready PRs
        if: github.event.pull_request.draft == false && github.event.action == 'ready_for_review'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            try {
              await github.rest.issues.removeLabel({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                name: 'work in progress'
              });
              console.log('Removed "work in progress" label from ready PR');
            } catch (error) {
              console.log('Label not found or error removing label:', error.message);
              // Don't fail if label doesn't exist
            }